!function(t){"use strict";function i(t){this.config={pluginClass:"wok-",pluginPrefix:"wok-"};for(var i in t)this.config[i]=t[i];this.pipes={},this.plugins={},this.debug=!1}Function.prototype.bind||(Function.prototype.bind=function e(t){var i=this,n=[].slice.call(arguments).slice(e.length);return function(){var e=n.concat([].slice.call(arguments));return i.apply(t,e)}}),i.prototype.use=function(t,e){var n=t;if(e||(e=i.plugins[t]),"string"==typeof e&&(n=e,e=this.plugins[e]),!e)throw new Error("Plugin "+n+" not known to Wok.");this.plugins[t]=e},i.prototype.init=function(t){for(var i in this.plugins)for(var e=this.plugins[i],n=t.querySelectorAll("[data-"+this.config.pluginPrefix+i+"]"),r=0;r<n.length;r++)this._initPlugin(e,i,n[r])},i.prototype._initPlugin=function(i,e,n){var r,o,s,u=(n.getAttribute("data-"+this.config.pluginPrefix+e)||"").trim().split("/"),p=u.shift(),a=u.shift(),l={};p&&(l.input=[p,function(){return s?s.render.apply(this,arguments):void(r=!0)}],l.input[1].displayName=e+"/"+p+"/input"),a&&(l.output=[a,function(){return s?s.request.apply(this,arguments):void(o=!0)}],l.output[1].displayName=e+"/"+a+"/output"),l=this.register(l),l.inputName=p||void 0,l.outputName=a||void 0;var g=t.parse("["+u.join("/")+"]");if(g.unshift(n),s=i.apply(l,g),!s)throw new Error("Wok plugin "+e+" did not return controls");if(s.request===!0&&(r=!0,delete s.request),s.render===!0&&(o=!0,delete s.render),p&&!("render"in s))throw new Error("Wok plugin “"+e+"” not meant to be used with input pipes");if(a&&!("request"in s))throw new Error("Wok plugin “"+e+"” not meant to be used with output pipes");r&&l.request(),o&&l.render(),null!==this.config.pluginClass&&(n.className+=" "+this.config.pluginClass+e)},i.prototype._getPipe=function(t){return t in this.pipes||(this.pipes[t]={source:null,destinations:[]}),this.pipes[t]},i.prototype._getStage=function(t,i){var e={};return t&&(e.request=this.request.bind(this,t)),i&&(e.render=this.render.bind(this,i)),e.wok=this,e},i.prototype.register=function(t){var i,e;return"input"in t&&(i=t.input[0],this.subscribe(i,t.input[1])),"output"in t&&(e=t.output[0],this.provide(e,t.output[1])),this._getStage(i,e)},i.prototype.provide=function(t,i,e){var n=this._getPipe(t);if(n.source&&!e)throw new Error("Cannot replace defined pipe “"+t+"”’s source");n.source=i},i.prototype.subscribe=function(t,i){var e=this._getPipe(t);e.destinations.push(i)},i.prototype.render=function(t){var i=this._getPipe(t),e=Array.prototype.slice.call(arguments,1);this.debug&&console.debug("Wok rendering "+t,e,i.destinations);for(var n=0;n<i.destinations.length;n++)i.destinations[n].apply(this,e)},i.prototype.request=function(t){var i=this._getPipe(t),e=Array.prototype.slice.call(arguments,1);return this.debug&&console.debug("Wok requesting "+t,e,i.source),i.source.apply(this,e)},i.plugins={},window.Wok=i}(window.JSON);
//# sourceMappingURL=Wok.min.js.map